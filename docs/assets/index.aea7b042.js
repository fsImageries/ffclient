var H=Object.defineProperty;var V=(s,e,n)=>e in s?H(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var h=(s,e,n)=>(V(s,typeof e!="symbol"?e+"":e,n),n);import{j as C,R as k,r as m,s as A,J,C as K,a as W}from"./vendor.d5d31611.js";const q=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))d(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&d(u)}).observe(document,{childList:!0,subtree:!0});function n(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerpolicy&&(i.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?i.credentials="include":l.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function d(l){if(l.ep)return;l.ep=!0;const i=n(l);fetch(l.href,i)}};q();const t=C.exports.jsx,c=C.exports.jsxs,L=C.exports.Fragment;class Z{constructor(e,n){h(this,"loaded");h(this,"setLoaded");h(this,"files");h(this,"_setFiles");h(this,"selected");h(this,"setSelected");h(this,"isPresets");h(this,"setPresets");h(this,"currentCommand");h(this,"_setCurrentCommand");h(this,"isExecuting");h(this,"setExecuting");h(this,"engine");h(this,"consoleRef");[this.loaded,this.setLoaded]=m.exports.useState(!1),[this.files,this._setFiles]=m.exports.useState([]),[this.selected,this.setSelected]=m.exports.useState([]),[this.isPresets,this.setPresets]=m.exports.useState(!1),[this.currentCommand,this._setCurrentCommand]=m.exports.useState(""),[this.isExecuting,this.setExecuting]=m.exports.useState(!1),this.engine=e,this.consoleRef=n}setFiles(e){const n=this._cleanCmd(e);this._setFiles(n),this.engine.evalFS(n.map(d=>d.name))}addFiles(e){this.setFiles([...this.files,...e]),this.engine.importFiles(e)}setCurrentCommand(e){this.consoleRef.current&&(this._setCurrentCommand(e),this.consoleRef.current.value=e)}_cleanCmd(e){const n=[],d={};for(let l=e.length-1;l>=0;l--){const i=e[l];d[i.name]||(d[i.name]=!0,n.push(i))}return n.reverse()}}const $=k.createContext({}),Q=({value:s,children:e})=>t($.Provider,{value:s,children:e}),X=()=>m.exports.useContext($),Y=(s,e,n=!0,d="text/plain")=>{const l=()=>{const v=new Blob([s],{type:d});return URL.createObjectURL(v)};let i=document.createElement("a");const u=n?l():s;i.href=u,i.download=e,i.click()},ee=(s,e)=>Array.isArray(s)&&Array.isArray(e)&&s.length===e.length&&s.every((n,d)=>n===e[d]),te=s=>{const e=[[1e3,"KB"],[1e6,"MB"],[1e9,"GB"]];for(let n of e){const[d,l]=n,i=s/d;if(Math.ceil(Math.log10(i+1))<2)return`${Math.round((i+Number.EPSILON)*100)/100}${l}`}},I=s=>[...s].map(e=>({name:e.name,url:URL.createObjectURL(e),size:e.size,wasUploaded:!0,srcFile:e})),g=A.createFFmpeg({log:!0});g.setProgress(({ratio:s})=>{const e=s<1?s*100:s/10;document.documentElement.style.setProperty("--cmdBtnProgress",`${e}%`)});const b=[".","..","tmp","home","dev","proc"];class se{load(e){(async()=>{await g.load(),e()})()}readdir(){return g.FS("readdir","/").filter(e=>!b.includes(e))}buildCmd(e){const n=/('.*?'|".*?"|\S+)/;return e=e.replaceAll(`
`,""),`${e}`.split(n).filter(l=>!(!l||l===" ")).map(l=>l.replaceAll('"',""))}evalFS(e){for(let n of this.readdir())e.includes(n)||g.FS("unlink",n)}async importFiles(e){for(let n of e)g.FS("writeFile",n.name,await A.fetchFile(n.srcFile))}async convertFiles(e,n){if(!this.readdir().length)return;const d=n.map(i=>i.name);await g.run(...e);const l=g.FS("readdir","/").filter(i=>!b.includes(i)&&!d.includes(i));return this._buildUrls(l)}_isEmpty(){return ee(g.FS("readdir","/"),b)}_buildUrls(e){return e.map(n=>{const d=g.FS("readFile",n),l=new Blob([d.buffer]),i=URL.createObjectURL(l);return{name:n,url:i,size:l.size,srcFile:l,wasUploaded:!1}})}}const N=({className:s,icon:e,onClick:n,style:d})=>t("div",{className:`${s} faicon`,onClick:n,style:d,children:t("i",{className:e})}),ne=({file:s,isSelected:e,onClick:n,onCloseClick:d})=>c("div",{className:`inputItem item ${e?"selected":""}`,children:[c("div",{className:"inputLabel",onClick:n,children:[t("div",{className:"text",title:s.name,children:s.name}),c("div",{className:"footer",children:[t("div",{className:"size",children:te(s.size)}),t("div",{className:"ext",children:`.${s.name.split(".").pop()}`})]})]}),t("a",{className:"downIcon",title:`Download ${s.name}`,download:s.name,href:s.url,children:t(N,{className:"downIcon",icon:"fas fa-caret-down"})}),t(N,{className:"closeIcon icon",icon:"fas fa-times",onClick:()=>d(s.name)})]}),le=()=>{const s=X();return t("div",{className:"inputs",children:s.files.map((e,n)=>t(ne,{file:e,isSelected:s.selected.includes(e.name),onClick:d=>{s.selected.includes(e.name)?s.setSelected(l=>l.filter(i=>i!==e.name)):s.setSelected(l=>[...l,e.name])},onCloseClick:d=>{const l=s.files.filter(u=>u.name!==d),i=s.selected.filter(u=>u!==d);s.setFiles(l),s.setSelected(i)}},n))})},F=({className:s,onChange:e,id:n})=>t("div",{className:`switchHolder ${s}`,children:c("label",{className:"switch",children:[t("input",{type:"checkbox",id:n,onChange:e}),t("span",{className:"slider round"})]})}),ie=({defaultChecked:s,text:e})=>c("label",{className:"option",children:[t("div",{className:"text",children:e}),t("input",{type:"radio",name:"options",id:"",defaultChecked:s})]}),re=({text:s,onChange:e})=>c("div",{className:"videoEntry entry",children:[t("div",{className:"switchText",children:s}),t(F,{id:`${s}Switch`,onChange:e})]}),ae=m.exports.forwardRef(({videoPresets:s,switchRadioButton:e,presetOnChange:n},d)=>c("div",{className:"presetsField",ref:d,children:[t("div",{className:"switchText",style:{padding:"1% 2%"},children:"Apply to"}),t("div",{className:"presetsOptions",onChange:e,children:["Uploaded","Selected","All"].map((l,i)=>t(ie,{defaultChecked:!i,text:l},i))}),t("div",{className:"switchText",style:{padding:"1% 2%"},children:"Convert to"}),c("div",{className:"presetsHolder",children:[c("div",{className:"videoField presetField",children:[t("div",{className:"switchText",children:"Videofiles"}),s.map((l,i)=>t(re,{text:l,onChange:u=>{u&&n(u,l)}},i))]}),c("div",{className:"imageField presetField",children:[t("div",{className:"switchText",children:"Imagefiles"}),c("div",{className:"imageEntry entry",children:[t("div",{className:"switchText",children:"JPG"}),t(F,{onChange:()=>{console.log("To JPG")}})]})]}),c("div",{className:"audioField presetField",children:[t("div",{className:"switchText",children:"Audiofiles"}),c("div",{className:"audioEntry entry",children:[t("div",{className:"switchText",children:"MP3"}),t(F,{onChange:()=>console.log("To MP3")})]})]})]})]}));const M=["AVI","MP4","WEBM","MPEG","MOV","FLV"],ce=()=>{const s=m.exports.useRef(null),e=m.exports.useRef(null),n=m.exports.useRef(null),d=m.exports.useRef(null),l=m.exports.useRef({selected:!1,uploaded:!0,all:!1}),i=m.exports.useRef(null),u=m.exports.useRef(null),v=new se,o=new Z(v,n);m.exports.useEffect(()=>{v.load(()=>o.setLoaded(!0))},[]);const S=async()=>{var f;const r=(f=n.current)==null?void 0:f.value,a=d.current;if(r&&a){const p=v.buildCmd(r);o.setExecuting(!0),a.classList.add("executing");const w=await v.convertFiles(p,o.files);a.classList.remove("executing"),w&&o.setFiles([...o.files,...w]),o.setExecuting(!1)}},_=()=>{const r=l.current;return r.selected?o.files.filter(a=>o.selected.includes(a.name)):r.uploaded?o.files.filter(a=>a.wasUploaded):o.files},O=r=>{var f;const a=(f=r.target.previousElementSibling)==null?void 0:f.innerHTML.toLowerCase();if(!!a)for(let p of Object.keys(l.current))l.current[p]=p===a},U=r=>{for(let a of M)if(a!==r){const f=document.getElementById(`${a}Switch`);f.checked=!1}},j=(r,a)=>{var R;U(a);const f=_();a=`.${a.toLocaleLowerCase()}`;let p="";if(f)for(let x=0;x<f.length;x++){const y=f[x],T=y.name.split("."),P=T.slice(0,T.length-1).join(""),E=y.name.includes(" "),z=E?`"${y.name}"`:y.name,G=E?`"${P+a}"`:P+a,D=` -map ${x} `;p=p+`-i ${z}${f.length>1?D:" "}${G} 
`}const w=p||`-i %filename% %outputname${a}%`,B=((R=r==null?void 0:r.currentTarget)==null?void 0:R.checked)?w:"";o.setCurrentCommand(B)};return o.loaded?t(Q,{value:o,children:c("div",{className:"App",children:[t("div",{className:"mainCardHolder",children:t("div",{className:"mainCard",children:o.files.length?c(L,{children:[t(le,{}),c("div",{className:"uploadField field",onClick:()=>{var r;(r=e.current)==null||r.click()},title:"Upload video or image files.",children:[t("input",{style:{display:"none"},ref:e,type:"file",multiple:!0,onChange:r=>{r.target.files&&o.addFiles(I(r.target.files))}}),t(N,{className:"uploadIcon icon",icon:"fas fa-plus"}),c("div",{className:"uploadLabel",children:[t("div",{className:"upper",children:"Add more files"}),c("div",{className:"lower",children:[o.files.length," file(s)"]})]})]}),t("div",{className:"downloadField field",onClick:()=>{if(!o.files.length)return;let r=new J;if(o.selected.length)for(let a of o.files)o.selected.includes(a.name)&&r.file(a.name,a.srcFile);else for(let a of o.files)r.file(a.name,a.srcFile);r.generateAsync({type:"blob"}).then(function(a){Y(URL.createObjectURL(a),"outputs.zip",!1)})},title:o.selected.length?"Download all selected files, zipped up.":"Download all available files, zipped up.",children:c("div",{className:"downloadLabel",children:[t("div",{className:"buttonIcon",children:[...Array(3).keys()].map((r,a)=>t(N,{className:"carrot left icon",icon:"fas fa-caret-down",style:{animationDelay:`${a}00ms`}},a))}),c("div",{className:"right",children:["Download",o.selected.length?` ${o.selected.length} file(s)`:" All"]})]})})]}):c(L,{children:[t("div",{className:"uploadField starter",children:c("div",{onClick:()=>{var r;return(r=s.current)==null?void 0:r.click()},style:{display:"flex",gap:"1vh",alignItems:"center"},children:[t(N,{className:"uploadIcon icon",icon:"fas fa-plus"}),c("div",{className:"textBlock",children:[t("input",{style:{display:"none"},ref:s,type:"file",multiple:!0,onChange:r=>{r.target.files&&o.addFiles(I(r.target.files))}}),t("div",{className:"switchText",children:"Upload Files"}),t("div",{className:"switchText small",children:"Videos, Images and Audio"})]})]})}),c("div",{className:"title",children:[t("div",{className:"switchText top",children:"FFClient"}),t("div",{className:"switchText body",children:"A web-based ffmpeg converter/console."}),t("div",{className:"switchText",children:"Powered by FFMPEG WASM."})]}),c("div",{className:"readmes",children:[c("div",{className:"switchText",children:["Read more about FFMPEG"," ",t("a",{className:"switchText",href:"https://www.ffmpeg.org/about.html",target:"_blank",children:"here."})]}),c("div",{className:"switchText",children:["Read more about FFMPEG WASM"," ",t("a",{className:"switchText",href:"https://ffmpegwasm.netlify.app/",target:"_blank",children:"here."})]}),c("div",{className:"switchText",children:["Getting started with FFMPEG"," ",t("a",{className:"switchText",href:"https://opensource.com/article/17/6/ffmpeg-convert-media-file-formats",target:"_blank",children:"here."})]}),c("div",{className:"switchText",children:["Getting started with FFMPEG WASM"," ",t("a",{className:"switchText",href:"https://github.com/ffmpegwasm/ffmpeg.wasm",target:"_blank",children:"here."})]}),c("div",{className:"switchText",children:["Find source code"," ",t("a",{className:"switchText",href:"https://github.com/fsImageries/ffclient",target:"_blank",children:"here."})]})]})]})})}),t("div",{className:`functionCardHolder ${o.files.length?"active":""}`,children:c("div",{ref:u,className:"functionCard",style:{height:o.isPresets?"80vh":"30vh"},children:[t("textarea",{title:"Hold shift and enter to execute current command.",ref:n,id:"consoleInput",spellCheck:!1,onKeyUp:async r=>{o.setCurrentCommand(r.currentTarget.value),r.key==="Enter"&&r.shiftKey&&o.files&&(r.currentTarget.blur(),S())}}),c("div",{className:"footer",children:[c("div",{className:"fieldOptions",children:[t("div",{className:"switchText",children:"Presets"}),t(F,{id:"PresetToggle",onChange:r=>{var f;const a=r==null?void 0:r.currentTarget.checked;a!==void 0&&(a||(f=u.current)==null||f.scrollTo({top:0,behavior:"smooth"}),o.setPresets(a))}})]}),c("div",{className:"command",ref:d,title:o.isExecuting?"Executing current command...":"Execute the current command.",onClick:()=>{S()},children:[t("div",{className:"buttonText",children:"Run Command"}),t("div",{className:"buttonIcon",style:{transform:"rotate(90deg)"},children:[...Array(3).keys()].map((r,a)=>t(N,{className:`carrot left icon ${o.isExecuting?"active":""}`,icon:"fas fa-angle-left",style:{animationDelay:`${a}00ms`}},a))})]})]}),t(K,{nodeRef:i,in:o.isPresets,unmountOnExit:!0,timeout:500,classNames:"presetsPrimary",children:t(ae,{ref:i,videoPresets:M,switchRadioButton:O,presetOnChange:j})})]})})]})}):t("div",{className:"loadingHolder",children:t("div",{className:"loadingCircle"})})};W.render(t(k.StrictMode,{children:t(ce,{})}),document.getElementById("root"));
